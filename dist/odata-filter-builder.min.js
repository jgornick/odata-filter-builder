!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.ODataFilterBuilder=t()}(this,function(){"use strict";function n(n){return"function"==typeof n&&(n=n(new h)),n&&n.toString()}function t(n,r){var i,o;return void 0===r&&(r=!1),"string"!=typeof n&&(n=1===n.rules.length?t(n.rules[0]):(i=n.rules,o=n.condition,i.map(function(n){return t(n,!0)}).join(" "+o+" "))),r?"("+n+")":n}function r(n){return"function"==typeof n?n(f):n}function i(n){return"string"==typeof n?"'"+n+"'":"object"==typeof(t=n)&&"[object Date]"===Object.prototype.toString.call(t)?n.toISOString():n;var t}function o(n,t,o,e,u){return void 0===e&&(e=!0),void 0===u&&(u=!1),t=r(t),void 0===o?o=[]:Array.isArray(o)||(o=[o]),0===o.length?n+"("+t+")":(e&&(o=o.map(i)),n+"("+(u?o.concat([t]):[t].concat(o)).join(", ")+")")}function e(n,t){return o("contains",n,t)}function u(n,t){return o("startswith",n,t)}function c(n,t){return o("endswith",n,t)}var f=Object.freeze({canonicalFunction:o,contains:e,startsWith:u,endsWith:c,toLower:function(n){return o("tolower",n)},toUpper:function(n){return o("toupper",n)},trim:function(n){return o("trim",n)},substring:function(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return o("substring",n,r)},concat:function(n,t,r){return o("concat",n,[t],r)},length:function(n){return o("length",n)},indexOf:function(n,t){return o("indexof",n,[t])}});function s(t){var r=n(t);if(r)return"not ("+r+")"}function d(n,t,o,e){return void 0===e&&(e=!0),n=r(n),e&&(o=i(o)),n+" "+t+" "+o}function a(n,t,i){return u=n,c="eq",void 0===(s=i)&&(s=!0),o=(f=t)?(u=r(u),Array.isArray(f)?f.map(function(n){return d(u,c,n,s)}):[d(u,c,f,s)]):[],e="or",o.join(" "+e+" ");var o,e,u,c,f,s}var h=function(){function r(n){if(void 0===n&&(n="and"),!(this instanceof r))return new r(n);this._condition=n,this._source={condition:n,rules:[]}}var i=r.prototype;return i._add=function(t,r){var i,o,e;return void 0===r&&(r=this._condition),this._source=(i=this._source,o=n(t),e=r,o&&(e&&i.condition!==e&&(i={condition:e,rules:i.rules.length>1?[i]:i.rules}),i.rules.push(o)),i),this},i.and=function(n){return this._add(n,"and")},i.or=function(n){return this._add(n,"or")},i.not=function(n){return this._add(s(n))},i.eq=function(n,t,r){return this._add(d(n,"eq",t,r))},i.ne=function(n,t,r){return this._add(d(n,"ne",t,r))},i.gt=function(n,t,r){return this._add(d(n,"gt",t,r))},i.ge=function(n,t,r){return this._add(d(n,"ge",t,r))},i.lt=function(n,t,r){return this._add(d(n,"lt",t,r))},i.le=function(n,t,r){return this._add(d(n,"le",t,r))},i.in=function(n,t,r){return this._add(a(n,t,r))},i.notIn=function(n,t,r){return this._add(s(a(n,t,r)))},i.contains=function(n,t){return this._add(e(n,t))},i.startsWith=function(n,t){return this._add(u(n,t))},i.endsWith=function(n,t){return this._add(c(n,t))},i.fn=function(n,t,r,i,e){return this._add(o(n,t,r,i,e))},i.isEmpty=function(){return 0===this._source.rules.length},i.toString=function(){return t(this._source)},r}();return h.and=function(){return new h("and")},h.or=function(){return new h("or")},h.functions=f,h.isODataFilterBuilder=function(n){return n instanceof h},h});
